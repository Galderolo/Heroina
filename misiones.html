<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heroes del Hogar - Misiones</title>
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#0f3460">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Heroes del Hogar">
    <link rel="apple-touch-icon" href="./img/icon-192.svg">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-adventure fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand fantasy-font" href="index.html">
                <i class="bi bi-shield-fill"></i> Heroes del Hogar
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item" id="installPWA" style="display: none;">
                        <a class="nav-link" href="#" id="installButton">
                            <i class="bi bi-download"></i> Instalar
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="bi bi-person-circle"></i> Mi Personaje
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="misiones.html">
                            <i class="bi bi-list-check"></i> Misiones
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="tienda.html">
                            <i class="bi bi-shop"></i> Tienda
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="container my-4">
        <!-- Header con Recursos -->
        <div class="card recursos-header shadow-sm mb-4">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <h4 class="fantasy-font mb-0">
                            <i class="bi bi-list-check"></i> Mis Misiones
                        </h4>
                    </div>
                    <div class="col-md-8">
                        <div class="stats-compact">
                            <span class="stat-item">
                                <small>Nivel</small> <strong id="headerNivel">1</strong>
                            </span>
                            <span class="stat-separator">|</span>
                            <span class="stat-item">
                                <small>Energ√≠a</small> <strong class="text-primary" id="headerEnergia">6</strong>
                                <br><small id="headerEnergyTimer" style="color: #a0a0a0; font-size: 0.7rem; display: none;"></small>
                            </span>
                            <span class="stat-separator">|</span>
                            <span class="stat-item">
                                <small>Vidas</small> <strong class="text-danger" id="headerVidas">6/6 ‚ù§Ô∏è</strong>
                            </span>
                            <span class="stat-separator">|</span>
                            <span class="stat-item">
                                <strong class="text-warning" id="headerOro">0 <i class="bi bi-coin text-warning"></i></strong>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="mb-4">
            <div class="btn-group w-100" role="group">
                <button type="button" class="btn btn-outline-primary active" onclick="filtrarMisiones('todas')">
                    Todas
                </button>
                <button type="button" class="btn btn-outline-success" onclick="filtrarMisiones('diaria')">
                    Diarias
                </button>
                <button type="button" class="btn btn-outline-info" onclick="filtrarMisiones('ayuda')">
                    Ayuda
                </button>
                <button type="button" class="btn btn-outline-warning" onclick="filtrarMisiones('epica')">
                    √âpicas
                </button>
            </div>
        </div>

        <!-- Lista de Misiones Diarias -->
        <div id="misionesDiarias" class="misiones-seccion">
            <h5 class="section-title">
                <i class="bi bi-sunrise"></i> Misiones Diarias
            </h5>
            <div id="listaDiarias" class="row">
                <!-- Se llenar√° con JavaScript -->
            </div>
        </div>

        <!-- Lista de Misiones de Ayuda -->
        <div id="misionesAyuda" class="misiones-seccion">
            <h5 class="section-title">
                <i class="bi bi-heart-fill"></i> Misiones de Ayuda
            </h5>
            <div id="listaAyuda" class="row">
                <!-- Se llenar√° con JavaScript -->
            </div>
        </div>

        <!-- Lista de Misiones √âpicas -->
        <div id="misionesEpicas" class="misiones-seccion">
            <h5 class="section-title">
                <i class="bi bi-trophy-fill"></i> Misiones √âpicas
            </h5>
            <div id="listaEpicas" class="row">
                <!-- Se llenar√° con JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div class="modal fade" id="modalConfirmacion" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="bi bi-check-circle"></i> Completar Misi√≥n</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <h5 class="mb-3" id="modalMisionNombre"></h5>
                    <p class="fs-6">¬øEsta misi√≥n ha sido completada?</p>
                    <div class="alert alert-info">
                        <small><i class="bi bi-info-circle"></i> Solo marca como completada si realmente se hizo la tarea</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-lg"></i> No, Cancelar
                    </button>
                    <button type="button" class="btn btn-success" onclick="confirmarMision()">
                        <i class="bi bi-check-lg"></i> S√≠, Completar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Recompensa -->
    <div class="modal fade" id="modalRecompensa" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-4">
                    <div class="mb-3">
                        <span class="mision-icono-grande" id="modalRecompensaIcono">‚ú®</span>
                    </div>
                    <h3 class="fantasy-font mb-3">¬°Misi√≥n Completada!</h3>
                    <h5 id="modalRecompensaMision" class="mb-4"></h5>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="recompensa-box">
                                <i class="bi bi-star-fill fs-1 text-info"></i>
                                <p class="mb-0 mt-2">XP Ganada</p>
                                <h3 class="text-info" id="modalRecompensaXP">0</h3>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="recompensa-box">
                                <i class="bi bi-coin fs-1 text-warning"></i>
                                <p class="mb-0 mt-2">Oro Ganado</p>
                                <h3 class="text-warning" id="modalRecompensaOro">0</h3>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-primary btn-lg mt-4" data-bs-dismiss="modal">
                        ¬°Genial!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Subida de Nivel -->
    <div class="modal fade" id="modalSubidaNivel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-4">
                    <i class="bi bi-trophy-fill fs-1 text-warning"></i>
                    <h2 class="fantasy-font mt-3">¬°Subiste de Nivel!</h2>
                    <p class="fs-4">Ahora eres nivel <span id="modalNuevoNivel"></span></p>
                    <div class="alert alert-success">
                        <h5>Nuevo T√≠tulo Desbloqueado:</h5>
                        <p class="fs-5 fw-bold mb-0" id="modalNuevoTitulo"></p>
                    </div>
                    <button type="button" class="btn btn-primary btn-lg" data-bs-dismiss="modal">
                        ¬°Genial!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modales Personalizados -->
    <!-- Modal de Alerta -->
    <div id="customAlert" class="custom-modal">
        <div class="custom-modal-content">
            <div class="custom-modal-icon" id="alertIcon">‚ÑπÔ∏è</div>
            <h3 id="alertTitle" style="color: #ffd700;">Aviso</h3>
            <p id="alertMessage" style="color: #e0e0e0; font-size: 1.1rem;"></p>
            <button class="custom-modal-btn" onclick="closeAlert()">Aceptar</button>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div id="customConfirm" class="custom-modal">
        <div class="custom-modal-content">
            <div class="custom-modal-icon">‚ö†Ô∏è</div>
            <h3 id="confirmTitle" style="color: #ffd700;">Confirmar</h3>
            <p id="confirmMessage" style="color: #e0e0e0; font-size: 1.1rem;"></p>
            <div class="custom-modal-buttons">
                <button class="custom-modal-btn btn-confirm" id="confirmYes">S√≠</button>
                <button class="custom-modal-btn btn-cancel" id="confirmNo">No</button>
            </div>
        </div>
    </div>

    <!-- Modal de Recompensa -->
    <div id="customReward" class="custom-modal">
        <div class="custom-modal-content reward-modal">
            <div class="reward-animation">üéâ</div>
            <h2 id="rewardTitle" style="color: #ffd700; font-size: 2rem;">¬°Misi√≥n Completada!</h2>
            <div class="reward-details" id="rewardDetails" style="color: #e0e0e0; font-size: 1.3rem; margin: 1.5rem 0;"></div>
            <button class="custom-modal-btn btn-success" onclick="closeReward()">¬°Genial!</button>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- Script de verificaci√≥n de versi√≥n -->
    <script src="js/version-check.js"></script>
    <script>
    (async function() {
        try {
            const versionCheck = await checkFilesVersion();
            if (versionCheck.needsUpdate) {
                // Invalidar cache del service worker
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (let registration of registrations) {
                        await registration.unregister();
                    }
                    // Limpiar cache
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        await Promise.all(cacheNames.map(name => caches.delete(name)));
                    }
                }
                // Guardar nuevas versiones
                saveStoredFileVersions(versionCheck.newVersions);
                // Recargar p√°gina para cargar nuevos archivos
                window.location.reload(true);
                return; // No continuar cargando scripts viejos
            }
            // Si no hay actualizaciones, guardar versiones actuales y continuar
            saveStoredFileVersions(versionCheck.newVersions);
        } catch (error) {
            console.error('Error en verificaci√≥n de versi√≥n:', error);
            // En caso de error, continuar normalmente
        }
    })();
    </script>
    
    <!-- Scripts del juego (solo se cargan si no hay actualizaci√≥n) -->
    <script src="js/modals.js"></script>
    <script src="js/data.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/game.js"></script>
    
    <!-- Script de la p√°gina -->
    <script>
        let misionSeleccionada = null;
        
        function actualizarHeader() {
            const summary = window.game.getCharacterSummary();
            const state = window.game.getState();
            const energy = state.character.energy || 0;
            const maxEnergy = state.character.maxEnergy || 6;
            const lives = state.character.lives !== undefined ? state.character.lives : 3;
            const maxLives = state.character.maxLives || 6;
            
            document.getElementById('headerNivel').textContent = summary.level;
            document.getElementById('headerEnergia').innerHTML = `${energy}/${maxEnergy} ‚ö°`;
            document.getElementById('headerVidas').innerHTML = `${lives}/${maxLives} ‚ù§Ô∏è`;
            document.getElementById('headerOro').innerHTML = `${summary.gold} <i class="bi bi-coin text-warning"></i>`;
            updateEnergyTimer();
        }
        
        function updateEnergyTimer() {
            const timerInfo = window.game.getEnergyTimerInfo();
            const timerElement = document.getElementById('headerEnergyTimer');
            
            if (!timerElement) return;
            
            if (timerInfo.isFull) {
                timerElement.style.display = 'none';
                return;
            }
            
            timerElement.style.display = 'block';
            const minutes = timerInfo.minutesRemaining;
            const seconds = timerInfo.secondsRemaining;
            
            if (minutes <= 0 && seconds <= 0) {
                const result = window.game.checkAndRestoreEnergy();
                if (result.restored) {
                    actualizarHeader();
                } else {
                    updateEnergyTimer();
                }
                return;
            }
            
            if (minutes > 0) {
                timerElement.textContent = `‚è±Ô∏è ${minutes}m ${seconds}s`;
            } else {
                timerElement.textContent = `‚è±Ô∏è ${seconds}s`;
            }
        }
        
        function crearTarjetaMision(mission) {
            const colorClass = {
                'diaria': 'border-success',
                'ayuda': 'border-info',
                'epica': 'border-warning'
            };
            
            const state = window.game.getState();
            const currentEnergy = state.character.energy || 0;
            const activeMissions = window.game.getActiveMissions();
            const isActive = activeMissions && activeMissions.some(m => m.missionId === mission.id);
            const hasMaxActive = activeMissions && activeMissions.length >= 3;
            const noEnergy = currentEnergy < 1 && !isActive;
            
            let buttonHTML = '';
            let cardClass = '';
            
            if (isActive) {
                const activeMission = activeMissions.find(m => m.missionId === mission.id);
                const hoursElapsed = (new Date() - new Date(activeMission.startDate)) / (1000 * 60 * 60);
                const hoursRemaining = 12 - hoursElapsed;
                
                let warningHTML = '';
                if (hoursRemaining <= 2 && hoursRemaining > 0) {
                    warningHTML = `<div class="alert alert-danger alert-sm mb-2">
                        <i class="bi bi-exclamation-triangle"></i> 
                        ‚ö†Ô∏è Quedan ${Math.ceil(hoursRemaining)} horas o fracasar√° autom√°ticamente
                    </div>`;
                } else if (hoursRemaining <= 0) {
                    warningHTML = `<div class="alert alert-danger alert-sm mb-2">
                        <i class="bi bi-exclamation-triangle"></i> 
                        ‚ö†Ô∏è Esta misi√≥n ha expirado y fracasar√° pronto
                    </div>`;
                }
                
                cardClass = 'mision-en-progreso';
                buttonHTML = `
                    ${warningHTML}
                    <button class="btn btn-complete-mission w-100 mb-2" onclick="completarMisionDirecta(${mission.id})">
                        <i class="bi bi-check-circle-fill"></i> ¬°Completar!
                    </button>
                    <div class="row">
                        <div class="col-6">
                            <button class="btn btn-danger w-100 btn-sm" onclick="fracasarMision(${mission.id})">
                                <i class="bi bi-x-circle-fill"></i> Fracas√≥ (-1 ‚ù§Ô∏è)
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-secondary w-100 btn-sm" onclick="cancelarMision(${mission.id})">
                                <i class="bi bi-arrow-counterclockwise"></i> Cancelar
                            </button>
                        </div>
                    </div>
                `;
            } else if (hasMaxActive) {
                cardClass = 'mision-deshabilitada';
                buttonHTML = `
                    <button class="btn btn-secondary w-100" disabled>
                        <i class="bi bi-lock"></i> M√°ximo de misiones alcanzado (3/3)
                    </button>
                `;
            } else if (noEnergy) {
                cardClass = 'mision-deshabilitada';
                buttonHTML = `
                    <button class="btn btn-secondary w-100" disabled>
                        <i class="bi bi-lightning-charge"></i> Sin energ√≠a (necesitas 1 ‚ö°)
                    </button>
                `;
            } else {
                buttonHTML = `
                    <button class="btn btn-primary w-100" onclick="iniciarMision(${mission.id})">
                        <i class="bi bi-play-fill"></i> Iniciar Misi√≥n (-1 ‚ö°)
                    </button>
                `;
            }
            
            return `
                <div class="col-md-6 col-lg-4 mb-3 mision-item" data-tipo="${mission.type}">
                    <div class="card h-100 mision-card ${colorClass[mission.type]} ${cardClass}">
                        <div class="card-body">
                            ${isActive ? '<div class="badge bg-warning text-dark mb-2"><i class="bi bi-hourglass-split"></i> En Progreso</div>' : ''}
                            <div class="mision-icono mb-2">${mission.icon}</div>
                            <h6 class="card-title fw-bold">${mission.name}</h6>
                            <p class="card-text small" style="color: #a0a0a0;">${mission.description}</p>
                            
                            <div class="mision-recompensas mb-3">
                                <span class="badge bg-primary me-2">
                                    <i class="bi bi-lightning-charge-fill"></i> 1 Energ√≠a
                                </span>
                                <span class="badge bg-info me-2">
                                    <i class="bi bi-star-fill"></i> ${mission.xp} XP
                                </span>
                                <span class="badge bg-warning">
                                    <i class="bi bi-coin"></i> ${mission.gold} Oro
                                </span>
                            </div>
                            
                            ${buttonHTML}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function cargarMisiones() {
            const daily = MISSIONS.filter(m => m.type === 'diaria');
            const help = MISSIONS.filter(m => m.type === 'ayuda');
            const epic = MISSIONS.filter(m => m.type === 'epica');
            
            document.getElementById('listaDiarias').innerHTML = daily.map(crearTarjetaMision).join('');
            document.getElementById('listaAyuda').innerHTML = help.map(crearTarjetaMision).join('');
            document.getElementById('listaEpicas').innerHTML = epic.map(crearTarjetaMision).join('');
        }
        
        function filtrarMisiones(tipo) {
            const sections = document.querySelectorAll('.misiones-seccion');
            const buttons = document.querySelectorAll('.btn-group .btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tipo === 'todas') {
                sections.forEach(s => s.style.display = 'block');
            } else {
                sections.forEach(s => s.style.display = 'none');
                if (tipo === 'diaria') {
                    document.getElementById('misionesDiarias').style.display = 'block';
                } else if (tipo === 'ayuda') {
                    document.getElementById('misionesAyuda').style.display = 'block';
                } else if (tipo === 'epica') {
                    document.getElementById('misionesEpicas').style.display = 'block';
                }
            }
        }
        
        function iniciarMision(missionId) {
            const result = window.game.startMission(missionId);
            
            if (!result.success) {
                showError(result.message);
                return;
            }
            
            cargarMisiones();
            actualizarHeader();
        }
        
        function cancelarMision() {
            showConfirm(
                'No pierdes nada, pero tampoco ganas.',
                '¬øCancelar la misi√≥n?',
                () => {
                    window.game.cancelActiveMission();
                    cargarMisiones();
                    actualizarHeader();
                }
            );
        }
        
        function fracasarMision() {
            showConfirm(
                'Se perder√° 1 vida ‚ù§Ô∏è y 1 de energ√≠a ‚ö°',
                '‚ö†Ô∏è ¬øSeguro que la misi√≥n FRACAS√ì?',
                () => {
                    const result = window.game.failActiveMission();
                    
                    if (!result.success) {
                        showError(result.message);
                        return;
                    }
                    
                    if (result.noLives) {
                        showAlert('Has perdido una vida.\n\n‚ö†Ô∏è ¬°NO QUEDAN VIDAS! Ten m√°s cuidado.', 'üíî ¬°Misi√≥n fracasada!', 'üíî');
                    } else {
                        showAlert(`Has perdido una vida.\nVidas restantes: ${result.remainingLives}`, 'üíî ¬°Misi√≥n fracasada!', 'üíî');
                    }
                    
                    setTimeout(() => {
                        cargarMisiones();
                        actualizarHeader();
                    }, 500);
                }
            );
        }
        
        function completarMisionDirecta(missionId) {
            const mission = MISSIONS.find(m => m.id === missionId);
            misionSeleccionada = mission;
            
            document.getElementById('modalMisionNombre').textContent = mission.name;
            
            const modal = new bootstrap.Modal(document.getElementById('modalConfirmacion'));
            modal.show();
        }
        
        function confirmarMision() {
            if (!misionSeleccionada) return;
            
            const result = window.game.completeActiveMission(misionSeleccionada.id);
            
            if (!result.success) {
                showError(result.message);
                return;
            }
            
            const modalConfirmacion = bootstrap.Modal.getInstance(document.getElementById('modalConfirmacion'));
            modalConfirmacion.hide();
            
            setTimeout(() => {
                mostrarRecompensa(result);
                
                if (result.leveledUp) {
                    setTimeout(() => {
                        mostrarSubidaNivel(result);
                    }, 2000);
                }
            }, 300);
            
            setTimeout(() => {
                cargarMisiones();
                actualizarHeader();
            }, 500);
            
            misionSeleccionada = null;
        }
        
        function mostrarRecompensa(result) {
            showReward(
                result.xpGained, 
                result.goldGained, 
                result.leveledUp ? result : null,
                result.mission.icon,
                result.mission.name
            );
        }
        
        function mostrarSubidaNivel(result) {
            document.getElementById('modalNuevoNivel').textContent = result.newLevel;
            document.getElementById('modalNuevoTitulo').textContent = result.title;
            
            const modal = new bootstrap.Modal(document.getElementById('modalSubidaNivel'));
            modal.show();
            
            confetti({
                particleCount: 200,
                spread: 100,
                origin: { y: 0.6 },
                colors: ['#FFD700', '#FFA500', '#FF8C00']
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.game.validateCharacterExists()) {
                return;
            }
            
            // Verificar misiones expiradas
            const expired = window.game.checkExpiredMissions();
            if (expired.length > 0) {
                showError(
                    `${expired.length} misi√≥n(es) han expirado despu√©s de 12 horas y han fracasado autom√°ticamente. Se ha perdido 1 vida por cada una.`,
                    '‚ö†Ô∏è Misiones Expiradas'
                );
            }
            
            cargarMisiones();
            actualizarHeader();
            
            // Actualizar temporizador de energ√≠a cada segundo
            setInterval(() => {
                updateEnergyTimer();
            }, 1000);
            
            // Verificar y restaurar energ√≠a cada minuto
            setInterval(() => {
                const result = window.game.checkAndRestoreEnergy();
                if (result.restored) {
                    actualizarHeader();
                } else {
                    updateEnergyTimer();
                }
            }, 60000);
        });
    </script>

    <!-- Registro del Service Worker para PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registrado:', registration.scope);
                    })
                    .catch(error => {
                        console.log('SW fallo:', error);
                    });
            });
        }
    </script>

    <!-- Bot√≥n Scroll to Top -->
    <button id="scrollToTop" class="scroll-to-top" title="Volver arriba">
        <i class="bi bi-arrow-up-circle-fill"></i>
    </button>

    <!-- PWA Install Button -->
    <script>
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPWA').style.display = 'block';
        });

        document.getElementById('installButton')?.addEventListener('click', async (e) => {
            e.preventDefault();
            
            if (!deferredPrompt) {
                return;
            }
            
            deferredPrompt.prompt();
            
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('Usuario acept√≥ instalar PWA');
            }
            
            deferredPrompt = null;
            document.getElementById('installPWA').style.display = 'none';
        });

        window.addEventListener('appinstalled', () => {
            document.getElementById('installPWA').style.display = 'none';
            deferredPrompt = null;
        });
    </script>

    <!-- Bottom Navigation Bar - Solo m√≥vil -->
    <nav class="bottom-nav d-lg-none">
        <a href="index.html" class="bottom-nav-item">
            <i class="bi bi-person-circle"></i>
            <span>Mi Personaje</span>
        </a>
        <a href="misiones.html" class="bottom-nav-item active">
            <i class="bi bi-list-check"></i>
            <span>Misiones</span>
        </a>
        <a href="tienda.html" class="bottom-nav-item">
            <i class="bi bi-shop"></i>
            <span>Tienda</span>
        </a>
    </nav>

    <!-- Scroll to Top functionality -->
    <script>
        const scrollToTopBtn = document.getElementById('scrollToTop');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        });
        
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>
</body>
</html>
